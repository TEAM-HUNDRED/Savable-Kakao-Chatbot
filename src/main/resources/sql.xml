<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd" >
<properties>
    <entry key="certList">
        WITH partiChall AS(SELECT
        m.username,
        m.kakao_id AS kakao_id,
        c.title AS title,
        data_row ->> 'startDate' AS startDate,
        data_row ->> 'endDate' AS endDate,
        data_row ->> 'goalCnt' AS goalCnt,
        data_row ->> 'challengeId' AS challengeId,
        data_row ->> 'certificationCnt' AS certificationCnt,
        data_row ->> 'isSuccess' AS isSuccess
        FROM "member" m ,
        jsonb_array_elements(m.participation) AS data_row JOIN challenge c ON (data_row ->> 'challengeId')::integer=c.id
        WHERE m.kakao_id =?
        AND current_date >= (data_row ->> 'startDate')::date
        AND current_date &lt;= (data_row ->> 'endDate')::date
        AND (data_row ->> 'challengeId')::integer = ?)
        SELECT
        (cert_data->>'date')::date AS DAY,
        count(1) AS count
        FROM "member" m ,
        partiChall AS pc JOIN jsonb_array_elements(m.certification) AS data_row
        ON (pc.challengeId = data_row ->> 'challenge_id'),
        jsonb_array_elements(data_row->'cert') AS cert_data
        WHERE m.kakao_id = pc.kakao_id
        AND pc.startDate::date &lt;= (cert_data->>'date')::date
        AND pc.endDate::date >=(cert_data->>'date')::date
        AND cert_data->>'check' != 'FAIL'
        GROUP BY day;
    </entry>
</properties>
